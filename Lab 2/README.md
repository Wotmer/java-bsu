# Bank Transaction System (HW2)

<details>
<summary>

![push](push_push.png)
</summary>

![invoker](dota_pudge.jpg)
</details>

## Теоретическая часть

### 1. Что такое UUID?

UUID (Universally Unique Identifier) — это 128-битный идентификатор. Его главное свойство — уникальность в пространстве
и времени без необходимости централизованной координации. Генерируется на основе времени, MAC-адреса и случайных чисел.
Вероятность коллизии (совпадения двух UUID) пренебрежимо мала.

### 2. Транзакции: UUID и Архитектура

* **UUID транзакции**: Это уникальный идентификатор конкретной операции (id чека). Нужен для идемпотентности (чтобы не
  списать деньги дважды при сбое сети) и аудита.
* **Критика архитектуры (User -> List<Account>)**:
    * *Проблема:* Хранение счетов внутри объекта User нарушает принцип единой ответственности. Если транзакция ссылается
      на "индекс счета в списке юзера", то при удалении одного счета все индексы съедут, и деньги уйдут не туда. Также
      это усложняет загрузку данных из БД (нужно грузить всего юзера, чтобы поменять баланс).
    * *Улучшение:* Выделить `Account` в независимую сущность. У Аккаунта есть поле `userId`. Транзакция ссылается строго
      на `accountId`.

### 3. SOLID в проекте

* **S (Single Responsibility):** Класс `Transaction` — просто данные. Класс `DepositCommand` — логика пополнения.
  `AuditLogger` — логирование.
* **O (Open/Closed):** Система открыта для расширения. Чтобы добавить "Кредит", мы создаем `CreditCommand`, не меняя код
  `TransactionManager`.
* **L (Liskov Substitution):** `JdbcAccountRepository` и `InMemoryAccountRepository` взаимозаменяемы через интерфейс
  `AccountRepository`.
* **I (Interface Segregation):** Интерфейс `CommandVisitor` отделен от `TransactionCommand`.
* **D (Dependency Inversion):** `TransactionManager` зависит от абстракции `AccountRepository`, а не от реализации.

### 4. Асинхронность

Для обеспечения атомарности и обработки миллиона пользователей используются:

* **`ReentrantLock`**: Блокировка на уровне конкретного аккаунта (а не всего банка).
* **`BlockingQueue`**: Буфер для входящих операций.
* **`ExecutorService`**: Пул потоков-воркеров, разбирающих очередь.

---

## Инструкция по запуску

### Требования

* **Java JDK:** Версия 17 или 21 (LTS).
* **Maven:** Установлен в системе.

### Способ 1: Запуск через терминал (Рекомендуемый)

В корневой папке проекта (где находится файл `pom.xml`) выполните команду:

```bash
mvn clean compile exec:java
